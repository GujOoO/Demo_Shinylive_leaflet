[{"name":"app.R","content":"library(sf)\r\nwbd_reg2 <- st_read(\"https://raw.githubusercontent.com/khondula/leaflet-in-R-shinydemo2/master/data/wbd_reg2.geojson\") \r\nwbd_reg2 <- wbd_reg2[wbd_reg2$REG == \"02\",] %>%\r\n   st_transform(4326)\r\n\r\n# user interface with map and color scheme widget\r\nui <- fluidPage(\r\n   leafletOutput(\"map\", height = 800),\r\n   absolutePanel(top = 10, right = 10, draggable = TRUE,\r\n      selectInput(inputId = \"colors\",\r\n         label = \"Color Scheme\",\r\n         choices = row.names(brewer.pal.info))\r\n   ))\r\n# server definition\r\nserver <- function(input, output) {\r\n   output$map <- renderLeaflet({\r\n      \r\n      # use this line with leafletproxy for default colors\r\n      pal <- colorNumeric(\"BrBG\", wbd_reg2$AREA) \r\n      \r\n      # map with polygons and legend\r\n      leaflet() %>%\r\n         addTiles() %>%\r\n         setView(lng = -76.505206, lat = 38.9767231, zoom = 7) %>%\r\n         addPolygons(data = wbd_reg2, \r\n            fill = TRUE,\r\n            color = \"black\", \r\n            weight =1,\r\n            fillColor = ~pal(AREA), # color is function of the wbd AREA column\r\n            fillOpacity = 0.8,\r\n            popup = ~HUC_NAME) %>%\r\n         addLegend(position = \"bottomright\", pal = pal, values = wbd_reg2$AREA)\r\n   })\r\n   \r\n   # update map using leaflet proxy instead of recreating the whole thing\r\n   # use observe to color layer as needed\r\n   observe({\r\n      # color palette is defined according to the user's input\r\n      pal <- colorNumeric(input$colors, wbd_reg2$AREA)\r\n      \r\n      # the map is updated with the new prefered color palette\r\n      # notice we use leafletProxy() instead of leaflet()\r\n      leafletProxy(\"map\") %>%\r\n         clearShapes() %>% clearControls() %>%\r\n         addPolygons(data = wbd_reg2, fill = TRUE,\r\n            color = \"black\", weight =1,\r\n            fillColor = ~pal(AREA),\r\n            fillOpacity = 0.8,\r\n            popup = ~HUC_NAME) %>%\r\n         addLegend(position = \"bottomright\", pal = pal, values = wbd_reg2$AREA)\r\n   })\r\n}\r\nshinyApp(ui, server)\r\n","type":"text"}]
